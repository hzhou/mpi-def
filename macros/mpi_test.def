subcode: test_p2p(p1, p2)
    &call p2p_region, $(p1), $(p2)
        $local tn_data

        $(if:is_main)
            tn_data = 1234
        $call send_to, &tn_data, 1, MPI_INT
        $(if:!is_main)
            $print Node $(p2): received data from node $(p1): $tn_data

        $(if:!is_main)
            tn_data = 4321
        $call send_back, &tn_data, 1, MPI_INT
        $(if:is_main)
            $print Node $(p1): received data from node $(p2): $tn_data
